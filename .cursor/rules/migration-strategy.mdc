---
description: Flywayマイグレーション戦略
globs: **/db/migration/*.sql
alwaysApply: false
---
# Flywayマイグレーション戦略

## 命名規則
```
V{バージョン番号}__{説明}.sql

例:
V1__create_users_table.sql
V2__add_email_verification.sql
```

## 実装例
```sql
-- V1__create_users_table.sql
CREATE TABLE users (
    id BINARY(16) PRIMARY KEY,
    email VARCHAR(100) NOT NULL UNIQUE,
    status VARCHAR(20) NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);
```

## Spring Boot設定
```yaml
# application.yml
spring:
  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true
```

## 環境別適用戦略
| 環境 | 適用方法 |
|-----|---------|
| 開発 | 自動適用 (アプリ起動時) |
| テスト | テスト開始前に自動適用 |
| 本番 | CI/CDパイプラインで適用 |

## アンチパターン
❌ 既存データを破壊的に変更する
❌ トランザクション考慮なしのマイグレーション 